"use strict";(self.webpackChunkcontabo_docs=self.webpackChunkcontabo_docs||[]).push([[61],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},b=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),b=c(n),f=a,m=b["".concat(s,".").concat(f)]||b[f]||p[f]||r;return n?o.createElement(m,i(i({ref:t},u),{},{components:n})):o.createElement(m,i({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}b.displayName="MDXCreateElement"},7513:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return p}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],l={title:"Automate Public Sharing",sidebar_position:4},s="Automate Public Sharing via S3 API",c={unversionedId:"Object-Storage/HowTo/public-sharing",id:"Object-Storage/HowTo/public-sharing",title:"Automate Public Sharing",description:"This How-To is for those who do want to do public sharing of files by automation tools. This might not be the only way, but the one also used by Contabo's Object Storage Panel. This relies on so calles policies.",source:"@site/docs/Object-Storage/HowTo/public-sharing.md",sourceDirName:"Object-Storage/HowTo",slug:"/Object-Storage/HowTo/public-sharing",permalink:"/docs/Object-Storage/HowTo/public-sharing",editUrl:"https://github.com/contabo/docs/tree/main/docs/Object-Storage/HowTo/public-sharing.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Automate Public Sharing",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Pre-signed URL",permalink:"/docs/Object-Storage/HowTo/presigned-url"},next:{title:"General Compatibility",permalink:"/docs/Object-Storage/Tools/compability"}},u={},p=[{value:"Setup your S3 tool",id:"setup-your-s3-tool",level:2},{value:"Enable Public Sharing for a file",id:"enable-public-sharing-for-a-file",level:2},{value:"Example for Enabling",id:"example-for-enabling",level:3},{value:"Example values",id:"example-values",level:4},{value:"Disable Public Sharing for a file",id:"disable-public-sharing-for-a-file",level:2}],b={toc:p};function f(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},b,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"automate-public-sharing-via-s3-api"},"Automate Public Sharing via S3 API"),(0,r.kt)("p",null,"This How-To is for those who do want to do public sharing of files by automation tools. This might not be the only way, but the one also used by Contabo's Object Storage Panel. This relies on so calles ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-policies.html"},"policies"),"."),(0,r.kt)("h2",{id:"setup-your-s3-tool"},"Setup your S3 tool"),(0,r.kt)("p",null,"The easiest way is to use ",(0,r.kt)("a",{parentName:"p",href:"/docs/Object-Storage/Tools/aws-cli"},"aws cli"),". Please make sure to have it installes and configured properly."),(0,r.kt)("h2",{id:"enable-public-sharing-for-a-file"},"Enable Public Sharing for a file"),(0,r.kt)("p",null,"Create a file ",(0,r.kt)("inlineCode",{parentName:"p"},"public-sharing-policy.json")," with following content"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Id": "your-fany-name",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foldername/file"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"This basically allows (",(0,r.kt)("inlineCode",{parentName:"p"},"Effect"),") reading Objects (",(0,r.kt)("inlineCode",{parentName:"p"},"s3:GetObject"),") by everyone (",(0,r.kt)("inlineCode",{parentName:"p"},"Principal"),") for the specified file (",(0,r.kt)("inlineCode",{parentName:"p"},"Resource"),")."),(0,r.kt)("h3",{id:"example-for-enabling"},"Example for Enabling"),(0,r.kt)("h4",{id:"example-values"},"Example values"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"S3 URL = ",(0,r.kt)("a",{parentName:"li",href:"https://eu2.contabostorage.com"},"https://eu2.contabostorage.com")),(0,r.kt)("li",{parentName:"ul"},"Bucket = foo"),(0,r.kt)("li",{parentName:"ul"},"File to share = foo/test.jpg"),(0,r.kt)("li",{parentName:"ul"},"Policy file = public-sharing-policy.json with following contents")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Id": "public-share-example-test",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foo/test.png"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api put-bucket-policy --bucket foo --policy file://public-sharing-policy.json\n")),(0,r.kt)("p",null,"The URL would be ",(0,r.kt)("a",{parentName:"p",href:"https://eu2.contabostorage.com/%7Bs3TenantId%7D:foo/test.png"},"https://eu2.contabostorage.com/{s3TenantId}:foo/test.png"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"s3TenantId")," can be retrieved via the ",(0,r.kt)("a",{parentName:"p",href:"https://api.contabo.com/#operation/retrieveObjectStorageList"},"Contabo API"),"."),(0,r.kt)("h2",{id:"disable-public-sharing-for-a-file"},"Disable Public Sharing for a file"),(0,r.kt)("p",null,"To disable the Public Sharing for a file you need first to get the current policy via"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api get-bucket-policy --bucket foo\n")),(0,r.kt)("p",null,"Then remove the parts you would like to remove and do the ",(0,r.kt)("inlineCode",{parentName:"p"},"put-bucket-policy")," again with the modified file. If it is the last entry in there you could also delete it completely via"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api delete-bucket-policy --bucket foo\n")),(0,r.kt)("p",null,"But be cautious as this will delete ALL policies on that bucket."))}f.isMDXComponent=!0}}]);